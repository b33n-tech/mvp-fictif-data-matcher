<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Data Matcher ‚Äì Multi fichiers fictifs</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial,sans-serif; background:#f5f7fa; margin:0; padding:0; }
header { background:#0f172a; color:white; padding:16px 24px; font-size:18px; font-weight:600; }
.container { padding:24px; }
input, select, button { margin-bottom:16px; padding:8px; border-radius:6px; border:1px solid #ccc; }
button { background:#2563eb; color:white; border:none; cursor:pointer; }
button:hover { background:#1e40af; }
table { width:100%; border-collapse:collapse; margin-top:16px; background:white; }
th, td { border:1px solid #e5e7eb; padding:8px; text-align:left; }
th { background:#f9fafb; }
</style>
</head>
<body>

<header>üîó Data Matcher ‚Äì Multi fichiers fictifs</header>
<div class="container">
    <label>Nombre de fichiers fictifs √† g√©n√©rer (2 √† 5) :</label>
    <select id="numFiles">
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
    </select><br>
    <button onclick="generateAndMatch()">G√©n√©rer et Matcher</button>
    <button onclick="downloadCSV()">T√©l√©charger CSV</button>

    <h3>R√©sultat :</h3>
    <table id="tableResult">
        <thead>
            <tr id="tableHead"></tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
// G√©n√©ration de donn√©es fictives par type
function generateData(type){
    const entries = [];
    for(let i=1;i<=10;i++){
        if(type==="Client"){
            entries.push({
                ID:"C"+i,
                Nom:"Client"+i,
                Email:"client"+i+"@mail.com"
            });
        } else if(type==="Produit"){
            entries.push({
                ID:"P"+i,
                Nom:"Produit"+i,
                Prix:(Math.floor(Math.random()*100)+1)
            });
        } else if(type==="Commande"){
            entries.push({
                ID:"O"+i,
                ClientID:"C"+((i%10)+1),
                ProduitID:"P"+((i%10)+1),
                Quantit√©:Math.floor(Math.random()*5)+1
            });
        } else if(type==="Fournisseur"){
            entries.push({
                ID:"F"+i,
                Nom:"Fournisseur"+i,
                Ville:["Paris","Lyon","Marseille"][i%3]
            });
        } else if(type==="Stock"){
            entries.push({
                ProduitID:"P"+i,
                Stock:Math.floor(Math.random()*50)
            });
        }
    }
    return entries;
}

// Normalisation simple pour matching
function normalize(str){
    if(!str) return '';
    return str.toUpperCase().replace(/\./g,'').trim();
}

// Merge des fichiers par cl√©
function mergeFiles(files){
    let merged = [];
    if(files.length===0) return merged;

    // On prend comme base le premier fichier
    merged = files[0].map(e=>({...e}));

    for(let f=1; f<files.length; f++){
        const current = files[f];
        current.forEach(item=>{
            // Cherche match sur ID si possible
            let key = item.ID || item.ClientID || item.ProduitID;
            let match = merged.find(m=>{
                let mKey = m.ID || m.ClientID || m.ProduitID;
                return normalize(mKey)===normalize(key);
            });
            if(match){
                Object.assign(match,item);
            } else {
                merged.push(item);
            }
        });
    }
    return merged;
}

// G√©n√©ration + fusion
let mergedData = [];
function generateAndMatch(){
    const n = parseInt(document.getElementById('numFiles').value);
    const types = ["Client","Produit","Commande","Fournisseur","Stock"];
    const selectedTypes = types.slice(0,n);

    const files = selectedTypes.map(t=>generateData(t));
    mergedData = mergeFiles(files);
    renderTable(mergedData);
}

// Affichage tableau
function renderTable(data){
    const head = document.getElementById('tableHead');
    const body = document.getElementById('tableBody');
    head.innerHTML=''; body.innerHTML='';
    if(data.length===0) return;

    const keys = Object.keys(data[0]);
    keys.forEach(k=>{
        const th = document.createElement('th');
        th.innerText = k;
        head.appendChild(th);
    });

    data.forEach(d=>{
        const tr = document.createElement('tr');
        keys.forEach(k=>{
            const td = document.createElement('td');
            td.innerText = d[k] || '';
            tr.appendChild(td);
        });
        body.appendChild(tr);
    });
}

// T√©l√©charger CSV
function downloadCSV(){
    if(mergedData.length===0) return;
    const keys = Object.keys(mergedData[0]);
    const csv = [
        keys.join(','), 
        ...mergedData.map(d=>keys.map(k=>d[k]||'').join(','))
    ].join('\n');

    const blob = new Blob([csv], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'merged.csv';
    a.click();
    URL.revokeObjectURL(url);
}
</script>

</body>
</html>
