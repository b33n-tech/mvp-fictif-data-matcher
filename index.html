<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Data Matcher â€“ Prototype Fictif</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial,sans-serif; background:#f5f7fa; margin:0; padding:0; }
header { background:#0f172a; color:white; padding:16px 24px; font-size:18px; font-weight:600; }
.container { padding:24px; }
button { padding:8px 12px; border-radius:8px; border:none; background:#2563eb; color:white; cursor:pointer; margin-bottom:16px; }
button:hover { background:#1e40af; }
table { width:100%; border-collapse:collapse; margin-top:16px; background:white; }
th, td { border:1px solid #e5e7eb; padding:8px; text-align:left; }
th { background:#f9fafb; }
</style>
</head>
<body>

<header>ðŸ”— Data Matcher â€“ Prototype Fictif</header>
<div class="container">
    <button onclick="matchFiles()">Lancer le matching</button>
    <button onclick="downloadCSV()">TÃ©lÃ©charger CSV</button>
    <h3>RÃ©sultat :</h3>
    <table id="tableResult">
        <thead>
            <tr id="tableHead"></tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
let file1 = [
    {Nom:"DUPUIS", Prenom:"Michel", Email:"michel.dupuis@mail.com"},
    {Nom:"MARTIN", Prenom:"Alice", Email:"alice@mail.com"},
    {Nom:"LEFEVRE", Prenom:"Julien", Email:"julien@mail.com"},
    {Nom:"BENOIT", Prenom:"Claire", Email:"claire@mail.com"},
    {Nom:"DURAND", Prenom:"Paul", Email:"paul@mail.com"},
    {Nom:"ROBERT", Prenom:"Sophie", Email:"sophie@mail.com"},
    {Nom:"MOREAU", Prenom:"Emma", Email:"emma@mail.com"},
    {Nom:"RICHARD", Prenom:"Louis", Email:"louis@mail.com"},
    {Nom:"FONTAINE", Prenom:"Julie", Email:"julie@mail.com"},
    {Nom:"GARNIER", Prenom:"Marc", Email:"marc@mail.com"}
];

let file2 = [
    {Nom:"M DUPUIS", Prenom:"Michel", Email:"m.dupuis@mail.com"},
    {Nom:"ALICE MARTIN", Prenom:"Alice", Email:"alice.martin@mail.com"},
    {Nom:"LEFEVRE", Prenom:"Julien", Email:"j.lefevre@mail.com"},
    {Nom:"BENOIT", Prenom:"Claire", Email:"claire.benoit@mail.com"},
    {Nom:"DURAND", Prenom:"Paul", Email:"p.durand@mail.com"},
    {Nom:"ROBERT", Prenom:"Sophie", Email:"s.robert@mail.com"},
    {Nom:"MOREAU", Prenom:"Emma", Email:"emma.moreau@mail.com"},
    {Nom:"RICHARD", Prenom:"Louis", Email:"l.richard@mail.com"},
    {Nom:"FONTANE", Prenom:"Julie", Email:"j.fontane@mail.com"},
    {Nom:"GARNIER", Prenom:"Marc", Email:"marc.garnier@mail.com"}
];

let mergedData = [];

function normalizeName(name){
    if(!name) return '';
    let n = name.toUpperCase();
    n = n.replace(/^(M |MME |DR )/,''); 
    n = n.replace(/\./g,''); 
    n = n.trim();
    return n;
}

function matchEntries(data1, data2){
    let merged = [];
    data1.forEach(d1=>{
        const n1 = normalizeName(d1.Nom) + ' ' + normalizeName(d1.Prenom);
        let matched = data2.find(d2=>{
            const n2 = normalizeName(d2.Nom) + ' ' + normalizeName(d2.Prenom);
            return n1 === n2;
        });
        if(matched){
            merged.push({...d1, ...matched});
        } else {
            merged.push(d1);
        }
    });
    data2.forEach(d2=>{
        const n2 = normalizeName(d2.Nom) + ' ' + normalizeName(d2.Prenom);
        if(!merged.some(d=>normalizeName(d.Nom)+' '+normalizeName(d.Prenom)===n2)){
            merged.push(d2);
        }
    });
    return merged;
}

function matchFiles(){
    mergedData = matchEntries(file1,file2);
    renderTable(mergedData);
}

function renderTable(data){
    const head = document.getElementById('tableHead');
    const body = document.getElementById('tableBody');
    head.innerHTML=''; body.innerHTML='';
    if(data.length===0) return;

    const keys = Object.keys(data[0]);
    keys.forEach(k=>{
        const th = document.createElement('th');
        th.innerText = k;
        head.appendChild(th);
    });

    data.forEach(d=>{
        const tr = document.createElement('tr');
        keys.forEach(k=>{
            const td = document.createElement('td');
            td.innerText = d[k] || '';
            tr.appendChild(td);
        });
        body.appendChild(tr);
    });
}

function downloadCSV(){
    if(mergedData.length===0) return;
    const keys = Object.keys(mergedData[0]);
    const csv = [
        keys.join(','), 
        ...mergedData.map(d=>keys.map(k=>d[k]||'').join(','))
    ].join('\n');

    const blob = new Blob([csv], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'merged.csv';
    a.click();
    URL.revokeObjectURL(url);
}

// Lancer automatiquement le matching au chargement
matchFiles();
</script>

</body>
</html>
